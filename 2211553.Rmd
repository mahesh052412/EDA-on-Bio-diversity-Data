---
title: "MA334-SP-Individual Assignment 2023"
author: '2211553'
subtitle: Biodiversity Proportional Species Richness
output:
  pdf_document: default
  html_document:
    df_print: paged
---

## INTRODUCTION:  

In this report, we use proportional_species_richness.csv to analyse species data, for data analysis and statistical analysis of biodiversity across Great Britain. These data represent a valuable resource for diversity of ecosystems based on ecological species value. We analyze species count and mean patterns of this data and apply the statistical analysis to consider the ecological status of species on land zones in Great Britain.

## METHODS:  

1.**Data Collection**  

2.**Sampling Methods**  

3.**Statistical techniques in Analysis**  

Sample data used for analysis:
```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
#set directory
setwd("C:/Users/HP/OneDrive/Desktop/Dan brown/TO-DO/EDA-on-Bio-diversity-Data")
#Import the data set
proj_assg <- read.csv("proportional_species_richness_V3.csv")

#load required packages
library(dplyr)
library(ggplot2)
library(gridExtra)
library(stringr)
library(tidyverse)

#Filter seven allocated species
proj_data <- select(proj_assg,c(2:5,7,10,11,13:17))

#Convert the categorical columns to factor
proj_data$dominantLandClass <- as.factor(proj_data$dominantLandClass)
proj_data$period <- as.factor(proj_data$period)

#calculate the mean ecological score of the seven allocated species
proj_data$ecostatusof7 <- rowMeans(proj_data[1:7])
head(proj_data,4)

```


## RESULTS:  

## **DATA EXPLORATION:**  

1.The below graph presents the mean difference, in the species richness compared to different time period between `BD7` and `BD11`. Thus, by the clear graphical presentation we can say, count of `BD11` and `BD7` has increased in the period "Y00" than "Y70".  

This shows that there could have been measures taken to improve richness during the period "Y70" and could have resulted in the future, thus shows the difference. But in both the time period their is a sudden spike and it has been depleted, this presentation could mean there is a shortage of data which could not give more accurate analysis.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}

#Distribution of BD7 and BD11 for both time periods
x <- ggplot(proj_data, aes(x=ecologicalStatus, fill=period)) +
  geom_histogram() +
  xlim(0.25, 1)

y <- ggplot(proj_data, aes(x=ecostatusof7, fill=period)) +
  geom_histogram() +
  xlim(0.25, 1.5)

grid.arrange(x,y,ncol=2)
```
  
  
2. Across whole of United kingdom there has been increase in ecosystem. One of the main reason is bees, which plays a very important role in pollinating plants, bees can be found in wide variety of land like forests, meadows, desert and in cities too.  
Here is a scatterplot representation of bees growth in easting and northing. The plot shows there is some outliers in "Y70" but significant increase in density of clustering of the bees over the period of "Y00".  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=4}

#The trend of bees' species richness along easting for both time periods
a <- proj_data %>%
  ggplot(aes(x=Easting, y=Bees)) +
  geom_point() + geom_smooth(method = lm) +
  facet_wrap(vars(period), ncol = 2, scales = "free") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

#The trend of bees' species richness along northing for both time periods
b <- proj_data %>%
  ggplot(aes(x=Northing, y=Bees)) +
  geom_point() + geom_smooth(method = lm) +
  facet_wrap(vars(period), ncol = 2, scales = "free") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

grid.arrange(a,b,ncol=2)

```


## **Hypothesis Testing:**  

1. For all land zone in Scotland, it has shown increase in mean of ecological score of 7 species.  

* Null hypothesis: Ecological score in Scotland has not increased over time.  

* Alternative hypothesis: Ecological score in Scotland has increased over time.  

The level of significance taken is 0.95  

```{r echo=FALSE, message=FALSE, warning=FALSE}

#filter for land zones in Scotland
scotland_data <- filter(proj_data,str_detect(dominantLandClass,"s"))

#Difference in BD7 b/w Y70 and Y00
dff_in_eco_score_scotland <- scotland_data%>%group_by(dominantLandClass,period)%>%
  summarise(meanof_7=mean(ecostatusof7), .groups = 'drop')%>%
  pivot_wider(names_from = period, values_from = meanof_7,values_fill = 0 )%>%
  mutate(period_dff=Y00-Y70)

#one-tail sample t-test
t.test(dff_in_eco_score_scotland$period_dff,alternative = "greater", mu=0, conf.level = 0.95 )
```
Conclusion:  
As the p-value is \< 0.05, we reject the Null-Hypothesis thus proving that the ecological species richness has increased in Scotland over time.  


2. The BD7 for each `dominantlandclass` has increased over time from Y70 to Y00:  

* Null hypothesis: BD7 for each `dominatlandclass` has not increased over time.  

* Alternative hypothesis: BD7 for each `dominatlandclass` has increased over time.  

The level of significance taken is 0.99  

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Difference in BD7 for all land zones across both time periods
best_eco_Y00 <- proj_data%>%group_by(dominantLandClass,period)%>%
  summarise(meanofall_eco=mean(ecostatusof7), .groups = 'drop')%>%
  pivot_wider(names_from = period, values_from = meanofall_eco,values_fill = 0 )%>%
  mutate(period_dff=Y00-Y70)

#one-tail sample t-test
t.test(best_eco_Y00$period_dff, alternative = "greater", mu=0, conf.level = 0.99 )

```
Conclusion:  

As the p-value is \< 0.05, we reject the Null-Hypothesis thus proving that the ecological species richness has increased over time.  

## **Simple linear regression**  

Overall, for both periods `Y70` and `Y00` BD7 does a good job in predicting BD11 which can be seen by the significance level `***` returned by the linear model. However, for period `Y00` the residuals are right skewed with median value of `\-0.000805` which tells us that the model does not predict the higher end of the species richness efficiently. The same can be verified from the Q-Q Plot.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, out.width='.5\\linewidth', fig.height=3}

#Filter data for specific time period
proj_Y70 <- proj_data %>% filter(period=="Y70")
proj_Y00 <- proj_data %>% filter(period=="Y00")

#Linear regression model for Y70
reg_proj_Y70 <- lm(proj_Y70$ecologicalStatus~proj_Y70$ecostatusof7)

#Combine actual and predicted values of BD11
lm_Y70 <- data.frame(x=fitted(reg_proj_Y70),y=proj_Y70$ecologicalStatus)

#plot the results of linear regression model for Y70
ggplot(lm_Y70,aes(x=x,y=y)) +
  geom_point() +
  geom_smooth(method=lm,se=F)

#Linear regression model for Y70
reg_proj_Y00 <- lm(proj_Y00$ecologicalStatus~proj_Y00$ecostatusof7)

#Combine actual and predicted values of BD11
lm_Y00 <- data.frame(x=fitted(reg_proj_Y00),y=proj_Y00$ecologicalStatus)

#plot the results of linear regression model for Y70
ggplot(lm_Y00,aes(x=x,y=y)) +
  geom_point() +
  geom_smooth(method=lm,se=F)
```
  
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=5, fig.height=3, out.width='.5\\linewidth'}

#Residual and QQ-plot for Y70
plot(jitter(fitted(reg_proj_Y70)),residuals(reg_proj_Y70),xlab="Fitted",ylab="Residuals", main = "Linear regression model for Y70")
abline(h=0)
qqnorm(reg_proj_Y70$residuals, main = "QQplot for Y70 residuals")
qqline(reg_proj_Y70$residuals,col="red")

#Residual and QQ-plot for Y00
plot(jitter(fitted(reg_proj_Y00)),residuals(reg_proj_Y00),xlab="Fitted",ylab="Residuals", main = "Linear regression model for Y00")
abline(h=0)
qqnorm(reg_proj_Y00$residuals, main = "QQ plot for Y00 residuals")
qqline(reg_proj_Y00$residuals,col="red")

```

## **Multiple linear regression**  

The objective of this section is to predict the value of `BD4`(mean ecological score of the remaining 4 species) using different combinations of the seven allocated species. From the below graph and the results returned by AIC it is observed that the model which takes all seven species as its predictors does an efficient prediction out of all the models run.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=7, fig.height=5.5, fig.align='left'}

#Filter out remaining four species from the original data
proj_assg_4 <- proj_assg%>%select(c(6,8,9,12))

#compute the mean ecological score of the four remaining species 
proj_data <- mutate(proj_data,meanof4=rowMeans(proj_assg_4[1:4]))

#Split the data into training and test set
trainig_sample <- sample(1:nrow(proj_data),0.8*nrow(proj_data))
training_data <- proj_data[trainig_sample,]
testing_data <- proj_data[-trainig_sample,]

#Running multiple linear regression model with all 7 species against BD4
mlr_proj1 <- lm(meanof4~.,
                data=training_data[c(1:7,14)],
                y=T)

#Run the model on the test data
mlr_proj1_test <- predict(mlr_proj1,testing_data)
df_for_mlr_proj1_test <- data.frame(predicted = mlr_proj1_test,observed = testing_data$meanof4)

#Running multiple linear regression model excluding 3 and 6
species_proj1 <- lm(meanof4~.,
                    data=training_data[c(1,2,4,5,7,14)],
                    y=T)
#Run the model on the test data
species_proj1_test <- predict(species_proj1,testing_data)
df_for_proj1 <- data.frame(predicted = species_proj1_test,observed = testing_data$meanof4)


#Running multiple linear regression model excluding 6
species_proj2 <- lm(meanof4~.,
                    data=training_data[c(1,2,3,4,5,14)],
                    y=T)

#Run the model on the test data
species_proj2_test <- predict(species_proj2,testing_data)
df_for_proj2 <- data.frame(predicted = species_proj2_test,observed = testing_data$meanof4)


#Running multiple linear regression model excluding 3
species_proj3 <- lm(meanof4~.,
                    data=training_data[c(1,2,4,5,6,7,14)],
                    y=T)

#Run the model on the test data
species_proj3_test <- predict(species_proj3,testing_data)
df_for_proj3 <- data.frame(predicted = species_proj3_test,observed = testing_data$meanof4) 


#Running multiple linear regression model excluding 3 and 4
species_proj4 <- lm(meanof4~.,
                    data=training_data[c(1,2,5,6,7,14)],
                    y=T)

#Run the model on the test data
species_proj4_test <- predict(species_proj4,testing_data)
df_for_proj4 <- data.frame(predicted = species_proj4_test,observed = testing_data$meanof4) 

#plot the regression results of all 5 models
par(mfrow=c(1,1))
p_1 <- ggplot(df_for_proj1,aes(x=predicted,y=observed))+
  geom_point()+
  geom_smooth(method = lm, se=F)+
  labs(x = "Predicted Values", y = "Observed Values", title = "Bees + Bird + Butterflies + Hoverflies + Grasshoppers") +
  theme(plot.title = element_text(size = 6))
p_2 <- ggplot(df_for_proj2,aes(x=predicted,y=observed))+
  geom_point()+
  geom_smooth(method = lm, se=F)+
  labs(x = "Predicted Values", y = "Observed Values", title = "Bees + Bird + Bryophytes + Butterflies + Hoverflies + Grasshoppers") +
  theme(plot.title = element_text(size = 6))
p_3 <- ggplot(df_for_proj3,aes(x=predicted,y=observed))+
  geom_point()+
  geom_smooth(method = lm, se=F)+
  labs(x = "Predicted Values", y = "Observed Values", title = "Bees + Bird + Butterflies + Hoverflies + Macromoths + Grasshoppers") +
  theme(plot.title = element_text(size = 6))
p_4 <- ggplot(df_for_proj4,aes(x=predicted,y=observed))+
  geom_point()+
  geom_smooth(method = lm, se=F)+
  labs(x = "Predicted Values", y = "Observed Values", title = "Bees + Bird + Hoverflies + Macromoths + Grasshoppers") +
  theme(plot.title = element_text(size = 6))
p_5 <- ggplot(df_for_mlr_proj1_test,aes(x=predicted,y=observed))+
  geom_point()+
  geom_smooth(method = lm, se=F)+
  labs(x = "Predicted Values", y = "Observed Values", title = "Bees + Bird + Bryophytes + Butterflies + Hoverflies + Macromoths + Grasshoppers") +
  theme(plot.title = element_text(size = 6))


grid.arrange(p_1, p_2, p_3, p_4, p_5, ncol=2)

#Evaluate the five models to find the efficient model for prediction
AIC(mlr_proj1,species_proj1,species_proj2,species_proj3,species_proj4)

```

\pagebreak
## **Open analysis**  

In this section, we analyse the proportional contribution of the highly correlated species to the mean species richness value(BD7) in all land zones for both time periods across all 3 countries(England, Scotland, Wales).  


```{r echo=FALSE, message=FALSE, warning=FALSE}

#Filter for the highly correlated species with BD7
cor_species <- proj_data %>% mutate(total=rowSums(proj_data[1:7],na.rm=T)) %>% 
  select(c("Bees","Butterflies","Hoverflies","Macromoths","ecostatusof7","period","dominantLandClass","total"))

#Calculate the proportions of the highly correlated species
cor_species <- cor_species %>% group_by(dominantLandClass,period) %>% 
  arrange(desc(ecostatusof7),.by_group = T) %>% top_n(5, wt = ecostatusof7) %>%
  mutate(count_bees=(Bees/total)*100,
         count_butterflies=(Butterflies/total)*100,
         count_hoverflies=(Hoverflies/total)*100,
         count_macromoths=(Macromoths/total)*100)

#Transform the data into required format
cor_species <- cor_species %>% select(c("period","dominantLandClass","count_bees","count_butterflies",
                                        "count_hoverflies","count_macromoths")) %>% 
  pivot_longer(cols = c("count_bees","count_butterflies",
                        "count_hoverflies","count_macromoths"),
               names_to = "species",values_to = "count_percentage" )
```  
  
#### **England**  

From the below graph, it is seen that the correlation between the species tends be on par on both the time period, expect for bees where it shows an increase over time.  


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=5.5, fig.align='left'}

#Plot the percentage count of species in all land zones in England for both time periods
cor_species %>% filter(str_detect(dominantLandClass,"e")) %>%
  ggplot(aes(x=species,y=count_percentage,fill=period)) +
  geom_bar(stat = "identity",position = "dodge")+
  facet_wrap(vars(dominantLandClass),scales = "free_x") +
  coord_flip()
```
  
\pagebreak
#### **Scotland**  

In this graph it is noted that the butterflies and bees tends to have a high indication from rest of the species. But still bees show more richness than butterflies.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=5.5, fig.align='left'}

#Plot the percentage count of species in all land zones in Scotland for both time periods
cor_species %>% filter(str_detect(dominantLandClass,"s")) %>%
  ggplot(aes(x=species,y=count_percentage,fill=period)) +
  geom_bar(stat = "identity",position = "dodge")+
  facet_wrap(vars(dominantLandClass),scales = "free_x") +
  coord_flip()
```
  
\pagebreak
#### **Wales**  

From the below plot, it is observed that in some land zones the bees have increased in the `Y00` period but have stayed on par with the other species across both time period.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=5.5, fig.align='left'}

#Plot the percentage count of species in all land zones in Wales for both time periods
cor_species %>% filter(str_detect(dominantLandClass,"w")) %>%
  ggplot(aes(x=species,y=count_percentage,fill=period)) +
  geom_bar(stat = "identity",position = "dodge")+
  facet_wrap(vars(dominantLandClass),scales = "free_x") +
  coord_flip()
```
